

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Services &#8212; My Homeserver</title>
    
    <link rel="stylesheet" href="_static/marcelene.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cron Jobs" href="cronjobs.html" />
    <link rel="prev" title="NextCloud" href="nextcloud.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">My Homeserver</a></div>
        <div class="rel">
          <a href="nextcloud.html" title="NextCloud"
             accesskey="P">previous</a> |
          <a href="cronjobs.html" title="Cron Jobs"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="services">
<h1>Services<a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h1>
<p>A few simple services my home server provides.</p>
<div class="section" id="syncthing">
<h2>SyncThing<a class="headerlink" href="#syncthing" title="Permalink to this headline">¶</a></h2>
<p>A dropbox replacement.
SyncThing provides an apt repository for installation and updates.</p>
<p>For configuration open <code class="docutils literal"><span class="pre">~/.config/syncthing/config.xml</span></code> with an editor.
Change the IP address at the <code class="docutils literal"><span class="pre">&lt;address&gt;127.0.0.1:8384&lt;/address&gt;</span></code> part,
so you can access the config remotely.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">At this point anybody can change your config.
Could we set a passwort via config.xml?
This would require knowing the hashing mechanism.</p>
</div>
<p>When setting the password,
I also enabled HTTPS,
so my password is transfered safely.</p>
<p>I do not plan to edit the files on my server.
It is just a background store.
This means it is not necessary to scan the directories every minute
(the default scan interval).
Especially for larger directories,
this means permanent useless activity.
You can change the “Rescan Interval” for each SyncThing folder in its settings.
I set them to 36000,
which is 10 hours.</p>
<div class="section" id="apparmor-profile">
<h3>AppArmor Profile<a class="headerlink" href="#apparmor-profile" title="Permalink to this headline">¶</a></h3>
<p>Using <code class="docutils literal"><span class="pre">aa-genprof</span></code>, I made a AppArmor profile,
which lives in <code class="docutils literal"><span class="pre">/etc/apparmor.d/usr.bin.syncthing</span></code>:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="c1">#include &lt;tunables/global&gt;</span>

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">syncthing</span> <span class="n">flags</span><span class="o">=</span><span class="p">(</span><span class="n">complain</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">#include &lt;abstractions/base&gt;</span>

  <span class="n">network</span> <span class="n">inet</span> <span class="n">dgram</span><span class="p">,</span>
  <span class="n">network</span> <span class="n">inet</span> <span class="n">stream</span><span class="p">,</span>
  <span class="n">network</span> <span class="n">inet6</span> <span class="n">dgram</span><span class="p">,</span>
  <span class="n">network</span> <span class="n">inet6</span> <span class="n">stream</span><span class="p">,</span>
  <span class="n">network</span> <span class="n">netlink</span> <span class="n">raw</span><span class="p">,</span>

  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span> <span class="n">r</span><span class="p">,</span>
  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nsswitch</span><span class="o">.</span><span class="n">conf</span> <span class="n">r</span><span class="p">,</span>
  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="o">.</span><span class="n">crt</span> <span class="n">r</span><span class="p">,</span>
  <span class="o">/</span><span class="n">home</span><span class="o">/*/.</span><span class="n">config</span><span class="o">/</span><span class="n">syncthing</span><span class="o">/</span> <span class="n">rw</span><span class="p">,</span>
  <span class="o">/</span><span class="n">home</span><span class="o">/*/.</span><span class="n">config</span><span class="o">/</span><span class="n">syncthing</span><span class="o">/**</span> <span class="n">rw</span><span class="p">,</span>
  <span class="o">/</span><span class="n">home</span><span class="o">/*/</span><span class="n">Sync</span><span class="o">/</span> <span class="n">rw</span><span class="p">,</span>
  <span class="o">/</span><span class="n">home</span><span class="o">/*/</span><span class="n">Sync</span><span class="o">/**</span> <span class="n">rw</span><span class="p">,</span>
  <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">somaxconn</span> <span class="n">r</span><span class="p">,</span>
  <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">resolvconf</span><span class="o">/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span> <span class="n">r</span><span class="p">,</span>
  <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">syncthing</span> <span class="n">mr</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Still in complain mode,
which means it will log stuff,
but not prevent anything.
I need to review this after a while.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="os.html">Operating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardening.html">Hardening</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="dyndns.html">Dynamic DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="nextcloud.html">NextCloud</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#syncthing">SyncThing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cronjobs.html">Cron Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="convenience.html">Convenience</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="fineprint.html">Fineprint</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="nextcloud.html" title="NextCloud"
             >previous</a> |
          <a href="cronjobs.html" title="Cron Jobs"
             >next</a>
            <br/>
            <a href="_sources/services.rst.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Andreas Zwinkau.
      Last updated on 2017-05-22.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.1.
    </div>
        </div>
        <div class="clearer"></div>
        <div id="feedback">
          For feedback <a href="mailto:qznc@web.de">write me an email to qznc@web.de</a>.
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>